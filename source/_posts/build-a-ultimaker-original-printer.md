title: Ultimaker Original 3D打印机DIY手记
date: 2015-02-02 16:11:46
tags:
categories: 软硬兼施
toc: true
---

一时兴起决定自己DIY一台3D打印机，现在网上的开源3D打印机还是不少的，基于DLP、激光的虽然高大上，但是机构精密、调试复杂，成本也比较高，所以我们基本还是考虑选一个[FDM技术](http://en.wikipedia.org/wiki/Fused_deposition_modeling)的。FDM技术就是将加热熔融的塑料丝从挤出嘴（喷头）中挤出，然后移动喷头来一层层地构建三维的实体。具体技术细节就不赘述了。

## 方案选择

既然选择了相对简单的FDM技术，在机型的选择上就一定要高大上，简陋的RepRap系列、并联臂结构的机型就不考虑了。至少应该有个外壳，看起来像个完整的产品，如果线缆横飞，机构外露，感觉就低端了很多，更像一个不成熟的实验品。目前商业化的机型当中开源的不多，大概只有Ultimaker和MakerBot两种，MakerBot只有Thing-O-Matic一款开源机型，后来就走向了闭源。而Ultimaker的大部分机型基本都是开源的，包括最初的Ultimaker Original以及比较新的Ultimaker 2.

更重要的是，Ultimaker系列3D打印机采用了更先进的机构设计，主要体现就是其远程挤出机。挤出机当中有步进电机、齿轮、轴承、弹簧、滚花螺栓等机械部件，算是一组相对较大的机构。MakerBot的设计是将挤出机背在打印头上，因此MakerBot的打印头比较笨重，因而跑不快。Ultimaker的设计是在机器的背面设计了一个远程挤出机，将打印材料通过一根鲍登管以送丝的方式送入打印头，这样就把挤出机从活动的打印头上剥离了出来，打印头也就轻便了许多，这个设计使得Ultimaker的打印头移动速度可以达到300mm/s，这是MakerBot的90mm/s望尘莫及的。因此我们就打算组装一台Ultimaker。

<!--more-->

本着“高大上”的指导方针，我们先下载了Ultimaker 2的图纸，感觉还是挺完整的，不过开始买材料时才发现有点过于高大上了。。。首先是外壳，铝塑复合板淘宝上结果很少，亚克力是不常用的6mm厚度，而且还要雕刻，不只是简单的激光切割。问了很多厂家，基本就是答复做不了，或者文件格式不对，或者是报一个很离谱的价格。相比而言，Ultimaker Original则要亲民得多，木质的外壳价格相对合理，加工也比较方便，由于推出的时间久一些，网上的一些零配件也多，一些难以处理的非标准铝件、注塑件也有成品可以买。官方对Ultimaker Original的支持力度似乎也很大，各种升级套装，比如热床升级、挤出机升级、双喷头升级等等。一些新的实验特性都会现在Ultimaker Original上实验，稳定后应用到其他机型上。也正如官方所说，Ultimaker Original是一款非常适合hack的机型，你可以方便地在喜欢的地方打个孔，安装一些新的东西。而最让我感到难以置信的是Ultimaker Original的性能参数，除了打印体积比Ultimaker 2稍小之外，各种精度速度都与Ultimaker 2一致，Z轴分辨率达到了0.02mm，比MakerBot的0.1mm高了一个数量级。对于其官方自称的“世界级”3D打印机，我认为还是名副其实的。

## 买成品 vs. 自己做

淘宝上还是有不少商家在卖Ultimaker的专用配件，比如“Ultimaker轴承套装”、“Ultimaker光轴套装”、“Ultimaker同步带、同步轮套装”、“Ultimaker主板”等等，而且这些东西的要价可都不低。如果只买一套，也许会便宜一些，像我打算买两套，一算根本不划算。比如主板，要价85～100+不等，其实那个根本就不是主板，就是一个Arduino Mega的转接板，上面的零件无非就是各种插座、开关外加几个LED和电阻电容。成本肯定不到30元。网上要价这么贵，以至于我以为这个主板是包含Arduino Mega的，但咨询后发现不含Arduino，这让我很生气，于是决定自己来制作这个主板，到嘉立创做了PCB打样，10块板子98元，两套做下来比买成品还要便宜一些，而且还多出了一堆配件。热电偶控制板更是如此，一个来自Analog的高大上的热电偶控制芯片AD597，这片SOP8的小芯片就要20多元，着实不便宜，不过黑店更牛，配上一片指头肚大的PCB和2个连接器，就敢叫价40元，实在呵呵。又是一样的步骤，做PCB打样，然后自己买芯片组装。。。40元12块PCB包邮，88元买了4个芯片，那种2.54mm的凤凰座要1元一个，有点小贵，做4块就比买成品便宜了。

同样的道理，Ultimaker的光轴套装也开出了90元的高价，也不知道是啥材料，硬度如何。上网找了一个专门卖光轴的商家，含运费155元订了两套，45号钢淬火工艺硬轴，感觉很棒。同步带和同步轮也类似，都是找了专门卖这种配件的商家买的，没有试图去“一站式配齐”。

这里还有件轶事，当时买螺丝的时候直接照着清单买的，根本就没关注这些螺丝分别用在什么地方，买了一些定位螺栓（set screw），需要10个我买了50个。后来才知道这个螺丝是用来固定同步带轮的，谁家的同步带轮会不配螺丝呢？于是就觉得这些螺丝浪费了。买回来的同步带轮一看，不仅没有自带定位螺栓，居然还打了2个洞！！！于是原计划的10个螺丝就变成了20颗，做两台就是40颗，50颗螺丝刚刚够用，好险……

## 电子系统

由于缺钱和任性，整个电子系统基本都是自己一点一点手工制作的。电子系统狭义上来说，由以下几个部分组成

* Arduino Mega 2560电路板，上面有MCU，作为控制器
* Arduino Mega Shield 1.5.7，这就是所谓的主板，其实只是一个转接板。
* A4988步进电机驱动器模块
* UltiPanel电路板，用于脱机打印和人机交互，上面有2004液晶、SD卡槽和旋转编码器
* AD597热电偶信号放大器

从广义上说，应该还包含：

* 步进电机
* 热电偶传感器
* 加热管
* 限位开关
* 电源

Arduino Mega 2560这个淘宝上太多了，价格也比较透明了，47元买了两块成品，没必要自己做了。A4988驱动芯片是QFN封装的，又是大电流的器件，PCB的铜厚要求2oz，做特殊工艺估计不便宜，QFN封装手工焊的也不可靠，尤其是那个散热焊盘焊不着，刚好成品不贵，所以也买成品了。电源去买了个19V，135W的一体机电源，拿在手里很大很有分量，感觉不错。热电偶信号板本来没放在眼里，后来一查淘宝被吓到了，才发现这玩意成品这么贵。。。打样的PCB都寄到手了，只做了Shield和UltiPanel，根本就没在意还有这么一小块，只好重新找了个离北京近的厂家再打样一次。

## 主板

主板全部都是直插的元件，很久不焊直插了，焊起来真费劲。还好我采取了“渐进式”焊接，PCB是最早寄到的，先焊了排针排母和一些电阻，后来随着MOSFET、电容等器件陆续寄到，每天都焊接当天收到的元件，这样化整为零，花了几天的时间组装了两套主板。如果一次性焊好，估计会很累吧……主板上几乎没有超过2元钱的元件，最贵的应该是那个奇葩的**弯脚钮子船型开关**，似乎是花了8元，MOSFET大概一块五，其余都是几毛几分的便宜货。

比较有意思的是DC电源接口，这个机器是利用常见的笔记本电源供电的，接口的规格是5.5\*2.5，也就是外径5.5mm，内径2.5mm。我的元件储备当中并没有这个规格的插座。因为我们平常做的都是小电子，包括Arduino在内，一般都用路由器电源类似的东西供电，接口的规格是5.5\*2.1。本想电源买回来剪掉原配插头，重新做一个2.1mm的接口，后来觉得不靠谱，也不太舍得把崭新的电源剪掉，于是老老实实地去中发买了2.5mm的DC插座，被所要了1元/个的高价，不过是小东西，也无所谓了。

## UltiPanel控制器

相比来说，虽然UltiPanel上面没几个元件，但故事却要多一些。8块钱的进口旋转编码器、9块钱的进口SD卡座都刷新了我的世界观。这个小小的控制器制作过程也颇为波折。

第一次把UltiPanel的所有器件焊接好后感觉问题不大，就打算直接把PCB塞进了木质的外壳里。图纸里要求的15mm长的塑料套管，由于型号规格比较奇葩，我买的是15mm的六角尼龙柱，里面是带螺纹的，把30mm长的螺丝拧过15mm的螺纹是一种非常呵呵的体验。15mm长的螺纹会带来巨大的摩擦力，要用钳子夹住尼龙柱非常用力地拧下去，拧完一个手就没劲了，一共要拧4个>_<。装完后发现屏幕距离外壳还有一个小的缝隙，感觉15mm的垫柱似乎有点长，于是就拿了垫主机主板用的16mm垫柱手工剪去了大概1.5mm，费了九牛二虎之力再把15mm螺柱拆下来换成剪短后的垫柱，感觉完美极了。遂将UltiController整个组装好，结果发现SD卡插入很吃力，而且无法自己弹出来，而这就是因为那个垫柱比设计要求的短了不到1mm……彻底无语，再次拆开，再次费九牛二虎之力拧上那个残念的带螺纹的垫柱，手已废。

安装好后烧了程序，进行了一个测试，Arduino Mega + Shield + UltiPanel三块板子，LCD显示出字了，很兴奋，不过提示了一个`Err: MINTEMP`。猜想应该是温度错误，因为热电偶控制器的PCB还没有寄到，随后发现LCD的字会消失一会儿，然后重新出现，字消失期间无法操作，后来发现是主板在不停地复位。猜想是由于温度错误触发了看门狗，于是用一个10k的电位器做了个分压，把信号接到测温度的ADC接口上。果然不复位了，提示`Ultimaker Ready.`

## SD卡和电平转换芯片

随后我就发现了一个奇怪的现象，SD卡虽然插入了，但仍然提示`No SD Card`，而且我在通电情况下插入和拔出SD卡，还能提示`Card inserted`和`Card removed`。上网查找了一下资料，说最好要用标准SD卡，不要用SDHC，而手头的卡确实是SDHC。于是断定是卡的问题，第二天就把这个没用的SD卡送人了。随即在淘宝上买了一张标称为“低速卡、兼容老相机”的SD卡，结果收到货后发现还是SDHC，而且插上去还是不能用……这就很可疑了，并不是说SDHC就一定不能用，网上的说法是，有些厂商没有在SDHC卡上正确地实现SPI接口的协议（SD卡一般通过SDIO接口通信），SanDisk和Lexar两个大厂商的卡，居然连SPI协议都实现不正确？可能性不大。估计是电路本身的问题了。

除了卡以外，最可疑的就是那个国产的电平转换芯片了。又仔细看了一下BOM，上面要求的是NXP的74HC4050D，我勒个去？好像不仅仅是国产山寨这么简单了，我买芯片的时候买的型号是CD4050，不是74HC4050D，我以为这两个型号差不多，事实上也确实差不多。我后来同时下载了NXP的这两个型号的芯片数据手册，发现只是工作电压有一点小的差别，而且我使用的电压都在规定值以内，至今我仍然认为这两个芯片在给SD卡电平转换时是等效的。不过错了就是错了，也不知道那个国产山寨CD4050的指标是不是跟NXP的一致，目前这个芯片最可疑了，所以我做了两手准备：又淘宝了一个确定是标准SD而不是SDHC的卡，然后找了一个北京中发电子城的卖家，买了NXP原装的74HC4050D。第二天去中发的实体店拿了74HC4050D，新买的SD卡还没到货，回来换上了新芯片，一试，果了个然！Lexar的SDHC卡成功读出来了，想必送人的那个SanDisk的卡也是能用的。

又过了一天，新买的金士顿的非SDHC的标准卡也寄到了，当然也是能用的，不过我发现那个卡片似乎很旧，上面有些污渍，金手指上也有划痕，想必是个二手货。于是上淘宝威胁了一下要给差评，卡片原来要价20元，加运费5元一共25元，由于放假要回家，也不想退货了，就要求直接退15元钱，相当于卡5元+运费5元买个二手货，其实也无所谓。卖家当然不愿意了，不过也是自觉理亏，卖了个萌就不点我了，于是我就默默等待那个退款申请过期，获得了15元的退款;-)

## 限位开关不得不吐的槽

另外一个有故事的器件就是限位微动开关。图纸上规定的是M3螺纹孔，我买的是欧姆龙的高级货，纯银触点4000万次寿命，每个的价格3.8元，不算便宜了。收到货后发现螺丝拧不进去，那个开关上的安装孔要比M3小一些，而且没有螺纹。看了欧姆龙的数据手册，发现那个孔的内径是2.35mm，特别奇葩。我还在中发问了有没有M3螺纹孔的，答曰没有，还带了一句“我们卖的都是标准的”。我这才意识到是Ultimaker的图纸太奇葩了。既然没有合适的开关适合我的螺丝，不如就去买适合的螺丝来配这个开关，买了一些M2.35的螺丝和专用螺母，花了一个下午的时间做好了双绞的接线和连接器，开开心心地进行整机总装了。

装好后发现了个大问题，官方图纸上那个安装孔是带螺纹的，所以不需要螺母，我用螺母固定了开关后，螺母的高度会阻碍X轴前滑块的移动，滑块上有一个小小的突起，用于压下限位器的金属片，而由于螺母的存在，那个突起的耳朵撞上金属片之前，滑块本体会先撞上螺母，还好我在通电之前用手推动滑块发现了这个问题，如果是通电之后出现这个问题，一定会出现电机被卡死，而系统本身还毫不知情的情况，因为限位器一直不会被压下，所以机器应该会一直试图归零滑块。

出现这个问题的限位器只是安装在前面板上的两个X轴限位器，其他的限位器设计的空间还足够容纳一个螺母。不想买新的限位器了，于是就尝试将限位器的孔扩到3mm左右，然后利用螺丝慢慢旋进去，给塑料的壁上刻上丝。上来就拧裂了俩开关，损失惨重，还好所有的零件我都至少买了两份。于是学乖了，螺丝旋进一点之后，反着拧，把塑料屑旋出来，如此反复，终于做好了两个能用的开关。我仍然不想去找M3螺纹的开关，因为它不标准。不行就去找个手动的丝锥来为限位开关攻丝吧。

## 总装调试

似乎该解决的问题都已经解决了。整机组装之后执行了Cura中的测试，测试了通信、温控、限位器以及XYZ三个轴的移动，测试都是正常的。随后打印了SD卡里的一个文件，置零、升温、送丝、回抽似乎所有的动作都是正常的。只可惜没有买打印材料，只能先看看热闹，等有了打印材料再具体调试了。

## 需要解决的问题

买了两套材料，打算组装一台双头的、一台单头的。现在组装了一台单头的，发现留给第二台的材料已经不够了，有些在第一台组装时遇到的问题，希望也能在装第二台时解决一下，记录如下：

* 椴木板加工问题
  - 外壳后面板（编号：1003）厚度不足
  - 丝杠螺母持片（编号：1103）厚度不足
  - 平台臂C2部件（编号：1109）缺失一个
* 限位开关安装孔小且没有螺纹，且数量不够
* 688轴承还剩10个，额外的送料机还需要用2个，之前不知道，因此要装双头的还缺2个轴承
* 3M 2090蓝色胶带没货
* PLA打印材料没买
* 热缩管不够了，应该再买些2mm～3mm的热缩管
* 热电偶的线太长
* 加热管的线太短
* 打印头风扇的风向似乎反了
* Z轴顶端的限位器位置需要调整
* A4988步进电机驱动器的需要调节
* 平台需要调平
* 丝杠需要润滑